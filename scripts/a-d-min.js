(function(){var g="cellSize",s="gridWidth",G="grid",N="canvas",D="click",f="img",J="moves",E="image/png",L=document,C="createElement",A=L[C](N),k=100,l=k/3,p=l*2,i=k/2,F=0,x=[[L[C](f),[l,l],[p,l],[i,p]],[L[C](f),[p,l],[p,p],[l,i]],[L[C](f),[l,p],[p,p],[i,l]],[L[C](f),[l,l],[l,p],[p,i]]],q,P,w=undefined,M="apply",n="getContext",m=256,r=Math,o="length",K="_controlButtons",j,H,O,z,t,b,y,Q,e,h,v,a,I,u;if(!A[n]){throw"This browser does not support the use of canvas"}A.width=A.height=k;q=A[n]("2d");z=function(c){q.fillStyle="#888";q.strokeRect(0,0,k,k);for(P=0;P<4;P++){q.clearRect(1,1,k-2,k-2);q.beginPath();q.moveTo(x[P][1][0],x[P][1][1]);q.lineTo(x[P][2][0],x[P][2][1]);q.lineTo(x[P][3][0],x[P][3][1]);q.fill();x[P][0].src=A.toDataURL(E).replace(E,"image/octet-stream");x[P][0].onload=function(){F++;if(F==x.length){c()}}}};j=function(T,d){var S,R,c;if(T.tagName!="DIV"){S=B.create("div");T.parentNode.replaceChild(S,T);T=S}this.parent=T;d=d||{};R=d.size||300;c=B.create(N,{width:R,height:R},this.parent);this.ctx=c[n]("2d");this[K]=[],H[M](this,[d.nbCellsSide||4,d.nbColors||4])};O=function(){this.infos={blobs:["Blobs",0],moves:[J,0],colors:["Colors",this.colors.length]};Object.keys(this.infos).forEach(function(c){this.infos[c][1]=B.create("span",{text:this.infos[c][1]},B.create("div",{text:this.infos[c][0]+": "},this.parent))}.bind(this))};t=function(c){return this.infos[c]?0|this.infos[c][1].innerHTML:false};b=function(d,c){if(!this.infos[d]){return false}this.infos[d][1].innerHTML=c};H=function(R,c){var d=this;Q[M](d,[c]);e[M](d,[R,c]);z(function(){h[M](d,[true])});O[M](d);u[M](d);I[M](d)};y=function(c){return 0|r.random()*c};Q=function(R){var T=[],W,U=R-1,d,V,S;V=function(){return[y(m),y(m),y(m)]};S=function(Y,X,c){return 0|(r.min(Y,X)+r.abs(Y-X)*c)};T[0]=V();T[U]=[];for(W=0;W<3;W++){T[U].push((T[0][W]+128)%m)}for(W=1;W<U;W++){d=W/U;T[W]=[S(T[0][0],T[U][0],d),S(T[0][2],T[U][1],d),S(T[0][1],T[U][2],d)]}this.colors=T;this.nbColors=T[o]};e=function(R,d){var c,S;this[G]=[];this[s]=R;for(c=0;c<R;c++){this[G][c]=[];for(S=0;S<R;S++){this[G][c][S]=y(d)}}};h=function(T){var d=this.ctx.canvas.clientWidth,c,U,S,R;this[g]=d/(this[s]+2);S=function(V,X){var W=this.colors[this[G][V][X]];this.ctx.fillStyle="rgb("+W+")";this.ctx.fillRect((V+1)*this[g],(X+1)*this[g],this[g],this[g])};R=function(Y,X,V,Z,W){for(Z=0;Z<V[o];Z++){this[K].push([Y,X]);this.ctx.drawImage(x[V[Z]][0],Y,X,this[g],this[g]);W=Y;Y=X;X=W}};for(c=0;c<this[s];c++){if(T){R[M](this,[(c+1)*this[g],0,[0,3]]);R[M](this,[d-this[g],(c+1)*this[g],[1,2]])}for(U=0;U<this[s];U++){S[M](this,[c,U])}}};a=function(R,S){var d,c=this._controlButtons.length;for(d=0;d<c;d++){if(this._controlButtons[d][0]<=R&&R<=this._controlButtons[d][0]+this[g]&&this._controlButtons[d][1]<=S&&S<=this._controlButtons[d][1]+this[g]){break}}return d==c?null:d};v=function(T){var U=this.ctx.canvas.getBoundingClientRect(),S=a[M](this,[T.clientX-U.left,T.clientY-U.top]),R,c,W,d,X,V;if(S==null){return}R=function(Y){var Z=this[G][Y][this[G][Y].length-1];this[G][Y].pop();this[G][Y].unshift(Z)};c=function(ac){var Z,Y=-1,ab,aa=this[G].length-1;for(ab in this[G]){Z=this[G][ab][ac];this[G][ab][ac]=~Y?Y:this[G][(ab+aa)%this[G].length][ac];Y=Z}};d=function(Y){var Z=this[G][Y][0];this[G][Y].shift();this[G][Y].push(Z)};W=function(aa){var Y,Z=this[G][0][aa];for(Y=0;Y<this[s];Y++){this[G][Y][aa]=this[G][(0|Y+1)%this[G].length][aa]}this[G][this[G].length-1][aa]=Z};X=0|S/4;switch(S%4){case 0:R[M](this,[X]);break;case 1:c[M](this,[X]);break;case 2:W[M](this,[X]);break;case 3:d[M](this,[X]);break}V=u.apply(this);b.apply(this,[J,0|t.apply(this,[J])+1]);h.apply(this,[false]);if(V==this.nbColors){B.off(this.parent,D,v.bind(this))}};I=function(){B.on(this.parent,D,v.bind(this))};u=function(){var U,T=0,c,S,d=this[s]*this[s],R;U=new Array(d);R=function(ac,ab,V){var X=this[G][ac][ab],Z=ab*this[s]+ac,W=Z-this[s],Y=Z+this[s],aa=Z+1,ad=Z-1;U[Z]=V;if(W>0&&U[W]==w&&this[G][ac][ab-1]==X){R[M](this,[ac,ab-1,V])}if(aa%this[s]>Z%this[s]&&U[aa]==w&&this[G][ac+1][ab]==X){R[M](this,[ac+1,ab,V])}if(Y<d&&U[Y]==w&&this[G][ac][ab+1]==X){R[M](this,[ac,ab+1,V])}if(r.abs(ad%this[s])<Z%this[s]&&U[ad]==w&&this[G][ac-1][ab]==X){R[M](this,[ac-1,ab,V])}};for(c=0;c<this[s];c++){for(S=0;S<this[s];S++){if(U[S*this[s]+c]!=w){continue}R[M](this,[c,S,T]);T++}}b[M](this,["blobs",T]);return T};window.Ad=j})();